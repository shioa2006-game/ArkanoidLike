# p5.js ブロック崩し

シンプルな p5.js 製アルカノイドクローンです。  
800x600 の論理座標で動作し、キーボード・マウス・タッチの入力に対応しています。

## 特徴

- **フル JavaScript / p5.js**：CDN の p5.js とバニラ JS のみを使用。フォルダ階層なしで HTML/CSS/JS ファイルを並列配置。
- **シーン管理**：`menu` / `play` / `pause` / `clear` / `over` / `win` の 6 シーンを行き来し、ゲーム進行を制御。
- **多彩なブロック**：Normal / Durable / Unbreakable / Explosive の 4 種を実装。耐久や爆発連鎖を再現。
- **5 種のパワーアップ**：EXPAND / SHRINK / SLOW / MULTI / STICKY を搭載し、効果時間を個別管理。
- **3 面構成**：`levels.js` で文字マップを定義し、クリアで次の面へ移動。全クリアで「完全クリア!」を表示。
- **デバッグ表示**：`T` キーで当たり判定やベクトルなどの補助情報を表示。

## ファイル構成

```
index.html   // p5.js 読み込みとキャンバス設置、操作説明
style.css    // レイアウトとフォント、キャンバスの中央配置
utils.js     // 物理計算・衝突判定・ランダムなどのユーティリティ
levels.js    // LEVELS 配列（ブロック配置マップ）
entities.js  // Paddle / Ball / Brick / Powerup クラス定義
sketch.js    // p5.js の setup/draw、シーン管理とゲームロジック
```

## 操作方法

### キーボード

- `←` / `→` または `A` / `D`：パドル移動
- `Space`：ボール発射・スティッキー解除 / ポーズ解除
- `P`：ポーズ ON/OFF
- `R`：ゲームリスタート
- `Esc`：メニューへ戻る
- `T`：デバッグ表示トグル

### マウス / タッチ

- カーソルまたはタッチ位置の X 座標にパドルが追従
- クリック / タップでボール発射

## ゲームルール

- 初期ライフは 3。ボールが落下するとライフを 1 消費し、パドル上から再発射待機状態へ。
- 正規化したヒット位置に応じて反射角を計算し、最小 20°〜最大 160°（上向き）にクランプ。
- ボール速度は基礎 300 px/s。SLOW 効果中は 0.75 倍。
- スコアはブロック破壊で加算：Normal +50 / Durable 最終ヒット +100 / Explosive +150。
- ステージ内の破壊可能ブロックを全て消すとクリア。3 面連続クリアで完全勝利。

## ブロックタイプ

| タイプ | 記号 | 説明 |
|--------|------|------|
| Normal | `N`  | 1 ヒットで破壊 |
| Durable | `D` | 耐久 2。色で段階表示 |
| Unbreakable | `U` | 破壊不可。スコアなし |
| Explosive | `E` | 破壊時に周囲 8 マスへダメージ |

## パワーアップ

| 種類 | 効果 | メモ |
|------|------|------|
| EXPAND | パドル幅 1.5 倍 (最大 2 倍) | 効果時間 12 秒。スタック可 |
| SHRINK | パドル幅 0.75 倍 (最小 0.5 倍) | 効果時間 12 秒。スタック可 |
| SLOW | 全ボール速度 0.75 倍 | 効果時間 8 秒。延長可 |
| MULTI | ボールを 2 個追加 | 最大 5 個まで |
| STICKY | パドル接触でボール吸着 | 効果時間 10 秒 |

パワーアップのドロップ率は 10%。落下中にパドルでキャッチすると即時発動します。

## 実行方法

1. リポジトリ直下の `index.html` をブラウザで開く。
2. メニュー画面でスペースまたはクリックするとゲーム開始。

ローカルサーバーは不要です。静的ファイルを直接開くだけで動作します。

## 開発メモ

- p5.js `draw()` 内で `deltaTime` を用い、`dt = min(1/30, deltaTime/1000)` としてフレームばらつきを緩和。
- 円 vs AABB の衝突判定は最近点法を使い、法線に基づく反射を実装。
- ボール角度は上向きに限定し、`clampUpwardAngle` で安全な反射角を維持。
- パワーアップ効果は `effectPools` と残り時間で管理し、ポリシーに応じて再計算。

## ライセンス

MIT License.
